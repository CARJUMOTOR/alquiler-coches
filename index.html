
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reserva Carjumotor</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; }
    .modal { max-width: 600px; margin: auto; padding: 20px; border-radius: 12px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15); background: white; }
    .resumen-card { border: 2px solid #007BFF; border-radius: 10px; padding: 20px; margin-top: 15px; background: #f9f9f9; }
    .resumen-card h3 { margin-top: 0; color: #007BFF; }
    .precio { font-size: 1.5em; color: #28a745; font-weight: bold; }
    .acciones { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    .acciones button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; }
    .confirmar { background: #28a745; color: white; }
    .cancelar { background: #dc3545; color: white; }
    .alerta { margin-top: 20px; padding: 12px; border-radius: 8px; font-weight: bold; }
    .alerta.exito { background: #d4edda; border: 1px solid #28a745; color: #155724; }
    .alerta.error { background: #f8d7da; border: 1px solid #dc3545; color: #721c24; }
    .alerta.info { background: #d1ecf1; border: 1px solid #0c5460; color: #0c5460; }
    label { display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: 1px solid #ccc; }
    button[type="submit"] { margin-top: 15px; padding: 12px; width: 100%; background: #007BFF; color: white; border: none; border-radius: 8px; cursor: pointer; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      emailjs.init("HajgaxooQYQn08xO1"); // Public key

      const form = document.getElementById("reservaForm");
      const resumenBox = document.getElementById("resumenBox");
      const mensajeBox = document.getElementById("mensajeConfirmacion");

      let datosReserva = {};

      form.addEventListener("submit", function(e) {
        e.preventDefault();

        const fi = document.getElementById("f_inicio").value;
        const ff = document.getElementById("f_fin").value;
        const nombre = document.getElementById("f_nombre").value;
        const telefono = document.getElementById("f_telefono").value;
        const email = document.getElementById("f_email").value;
        const obs = document.getElementById("f_obs").value;
        const coche = "Opel Corsa 100 CV - Gasolina Hybrid";
        const precio = "250 €";

        datosReserva = {
          name: nombre,
          telefono: telefono,
          email: email,
          fechainicio: fi,
          fechafin: ff,
          coche: coche,
          precio: precio,
          observaciones: obs
        };

        resumenBox.innerHTML = `
          <div class="resumen-card">
            <h3>Resumen de tu reserva</h3>
            <p><strong>Nombre:</strong> ${nombre}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Teléfono:</strong> ${telefono}</p>
            <p><strong>Fechas:</strong> ${fi} a ${ff}</p>
            <p><strong>Coche:</strong> ${coche}</p>
            <p class="precio">Precio final: ${precio}</p>
            <div class="acciones">
              <button class="confirmar" id="btnConfirmar">Confirmar</button>
              <button class="cancelar" id="btnCancelar">Cancelar</button>
            </div>
          </div>
        `;

        document.getElementById("btnConfirmar").onclick = enviarReserva;
        document.getElementById("btnCancelar").onclick = () => resumenBox.innerHTML = "";
      });

      function enviarReserva() {
        mensajeBox.innerHTML = '<div class="alerta info">⏳ Enviando reserva...</div>';

        // Enviar primero al correo de Carjumotor
        emailjs.send("service_9uud3ei", "template_wjryzug", datosReserva)
          .then(() => {
            // Después al cliente
            return emailjs.send("service_9uud3ei", "template_ieuq4vc", datosReserva);
          })
          .then(() => {
            mensajeBox.innerHTML = '<div class="alerta exito">✅ Reserva enviada con éxito.</div>';
            resumenBox.innerHTML = "";
            form.reset();
          })
          .catch(err => {
            console.error(err);
            mensajeBox.innerHTML = '<div class="alerta error">❌ Error al enviar la reserva. Intenta de nuevo.</div>';
          });
      }
    });
  </script>
</head>
<body>
  <div class="modal">
    <h2>Formulario de reserva</h2>
    <form id="reservaForm">
      <label>Fecha inicio <input type="date" id="f_inicio" required></label>
      <label>Fecha fin <input type="date" id="f_fin" required></label>
      <label>Nombre <input type="text" id="f_nombre" required></label>
      <label>Teléfono <input type="tel" id="f_telefono" required></label>
      <label>Email <input type="email" id="f_email" required></label>
      <label>Observaciones <textarea id="f_obs" rows="3"></textarea></label>
      <button type="submit">Enviar reserva</button>
    </form>
    <div id="resumenBox"></div>
    <div id="mensajeConfirmacion"></div>
  </div>
</body>
</html>
