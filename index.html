<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carjumotor - Alquiler de Coches</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("HajgaxooQYQn08xO1"); // Tu Public Key
    })();
  </script>
</head>
<body>
  <header>
    <nav>
      <a href="#inicio">Inicio</a>
      <a href="#nosotros">Nosotros</a>
      <a href="#contacto">Contacto</a>
    </nav>
  </header>

  <section id="inicio">
    <h1>Alquiler de Coches - Carjumotor</h1>
    <div class="coches">
      <!-- Opel Corsa (activo) -->
      <div class="coche">
        <img src="corsa.jpg" alt="Opel Corsa">
        <h3>Opel Corsa 100 CV - Gasolina Hybrid</h3>
        <p>40 €/día + IVA</p>
        <button onclick="abrirModal('Opel Corsa 100 CV - Gasolina Hybrid', 40)">Reservar</button>
      </div>
      <!-- Otros coches (deshabilitados) -->
      <div class="coche">
        <img src="seat.jpg" alt="Seat Ibiza">
        <h3>Seat Ibiza</h3>
        <p>No disponible</p>
        <button disabled style="background:#ccc;cursor:not-allowed">Reservar</button>
      </div>
      <div class="coche">
        <img src="renault.jpg" alt="Renault Clio">
        <h3>Renault Clio</h3>
        <p>No disponible</p>
        <button disabled style="background:#ccc;cursor:not-allowed">Reservar</button>
      </div>
    </div>
  </section>

  <!-- Modal de reserva -->
  <div id="modalReserva" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;">
    <div style="background:#fff;padding:20px;border-radius:10px;max-width:500px;width:100%;">
      <h2>Formulario de Reserva</h2>
      <form id="reservaForm">
        <input type="hidden" name="coche" id="hiddenCar">
        <label>Fecha inicio
          <input type="date" id="f_inicio" required>
        </label>
        <label>Fecha fin
          <input type="date" id="f_fin" required>
        </label>
        <input type="text" id="f_nombre" placeholder="Nombre completo" required style="width:100%">
        <input type="tel" id="f_telefono" placeholder="Teléfono" required style="width:100%">
        <input type="email" id="f_email" placeholder="Email" required style="width:100%">
        <textarea id="f_obs" placeholder="Observaciones" style="width:100%"></textarea>
        
        <div id="resumenReserva" style="margin:15px 0;padding:10px;background:#f9f9f9;border-radius:8px;display:none"></div>

        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button type="submit" class="reserve-btn">Enviar reserva</button>
          <button type="button" onclick="cerrarModal()" style="background:#eee;border-radius:8px;padding:10px 12px">Cancelar</button>
        </div>
      </form>
      <p id="mensajeReserva"></p>
    </div>
  </div>

  <script>
    let activeCar = { nombre: "", precio: 0 };

    function abrirModal(coche, precio){
      activeCar = { nombre: coche, precio: precio };
      document.getElementById("hiddenCar").value = coche;
      document.getElementById("modalReserva").style.display = "flex";
    }
    function cerrarModal(){
      document.getElementById("modalReserva").style.display = "none";
      document.getElementById("resumenReserva").style.display = "none";
    }

    document.getElementById("reservaForm").addEventListener("submit", function(e){
      e.preventDefault();
      const fi = document.getElementById("f_inicio").value;
      const ff = document.getElementById("f_fin").value;
      const nombre = document.getElementById("f_nombre").value;
      const tel = document.getElementById("f_telefono").value;
      const email = document.getElementById("f_email").value;
      const obs = document.getElementById("f_obs").value;
      const coche = activeCar.nombre;

      const dias = (new Date(ff) - new Date(fi)) / (1000*60*60*24) + 1;
      const precioFinal = dias * activeCar.precio;
      const precioConIVA = (precioFinal * 1.21).toFixed(2) + " €";

      const resumen = document.getElementById("resumenReserva");
      resumen.style.display = "block";
      resumen.innerHTML = `
        <h4>Resumen de la reserva</h4>
        <p><strong>Coche:</strong> ${coche}</p>
        <p><strong>Fechas:</strong> ${fi} a ${ff}</p>
        <p><strong>Días reservados:</strong> ${dias}</p>
        <p><strong>Precio final (IVA incluido):</strong> ${precioConIVA}</p>
      `;

      emailjs.send("service_9uud3ei","template_ieuq4vc",{
        name: nombre,
        telefono: tel,
        email: email,
        coche: coche,
        fechainicio: fi,
        fechafin: ff,
        precio: precioConIVA,
        observaciones: obs
      }).then(function(){
        document.getElementById("mensajeReserva").innerHTML = "<span style='color:green'>Reserva enviada con éxito. Copia enviada a Carjumotor y al cliente.</span>";
      }, function(){
        document.getElementById("mensajeReserva").innerHTML = "<span style='color:red'>Error al enviar la reserva. Intenta de nuevo.</span>";
      });
    });
  </script>
</body>
</html>
